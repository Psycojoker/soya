-extends "base.haml"
-load bootstrap3
-load staticfiles

-block head
  :css
    .progress {
      background-color: #FFFFFF;
    }

-block content
  -# put here to allow DjangoResumable to get it
  -csrf_token

  %div{ng-app: "soya", ng-controller: "VideoUploadController"}
    %div{ng-repeat: "upload in uploads"}
      .well
        %div{ng-if: 'upload.isSubmited == false || upload.state != "done"'}
          %form{method: "post", id: "upload_form_{& upload.id &}"}
            %fieldset
              -csrf_token
              %div{ng-if: 'upload.isSubmited == true'}
                En attente que '{& upload.title &}' soit complétement uploadé -
                %a{ng-click: "upload.isSubmited = false", href: "#"}
                  editer
              .row{ng-if: 'upload.isSubmited == false'}
                .col-md-6
                  .form-group{class: "{% if form.title.errors %}has-error{% elif form.data and form.title %}has-success{% endif %}"}
                    %label.control-label{for: "title"}
                      Titre de la vidéo
                    %input#id_title.form-control{type: "text", required: "", placeholder: "Titre de la vidéo", name: "title", value: "", ng-model: "upload.title"}
                    -for error in form.title.errors
                      %span.help-block= error

                .col-md-6
                  -bootstrap_field form.subsubsection
              .form-group
                %input#id_file_name-path{type: "hidden", name: "file_name-path", value: "None"}
                %input#id_file_name{type: "file", name: "file_name", title: "", data-upload-url: "/administration/upload/", multiple: "multiple"}
            %button.btn.btn-primary{type: "submit", ng-click: "saveVideo(upload.id)", ng-if: 'upload.isSubmited == false'}
              Enregistrer
            -#
              %button.btn.btn-danger{ng-disabled: 'upload.state != "running"'}
                Stop

        %div{ng-if: 'upload.isSubmited == true && upload.state == "done"'}
          %p{style: "margin-bottom: 0px"}
            '{& upload.title &}' a été correctement enregistré.

    %button.btn.btn-primary{ng-click: "addUpload()"}
      Uploader une vidéo en plus

- block javascript
  %script{src: "{{ STATIC_URL }}js/resumable.js", type: "text/javascript"}
  %script{src:"{{ STATIC_URL }}js/django-resumable.js", type:"text/javascript"}
  %script{src: "{{ STATIC_URL }}js/upload.js"}
